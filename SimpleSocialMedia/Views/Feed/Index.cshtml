@model IEnumerable<SimpleSocialMedia.Models.PostModel>

@using System.Security.Claims;

@{
    ViewData["Title"] = "Новости";
    var defaultAvatarUrl = Url.Content("~/images/default-user-pic.jpg");
}

<head>
    <link rel="stylesheet" href="~/css/feed.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<h1>Лента новостей</h1>

@foreach (var post in Model)
{
    <div class="post" data-post-id="@post.Id">
        <div class="post-header">
            <img class="avatar" src="@(post.User.AvatarUrl ?? defaultAvatarUrl)" alt="Avatar" onerror="this.onerror=null; this.src='@(defaultAvatarUrl)';" />
            <div class="post-info">
                <span class="username">@post.User.UserName</span>
                <span class="created-at">@post.CreatedAt.ToString("g")</span>
            </div>
        </div>
        <div class="post-content">
            <p>@post.Content</p>
        </div>
        <div class="post-actions">
            <div class="likes">
                <div class="like-actions-pic">
                    <img src="~/images/@(post.Likes.Any(l => l.UserId == User.FindFirstValue(ClaimTypes.NameIdentifier)) ? "liked.svg" : "not-liked.svg")" height="30px" class="like-toggle" />
                </div>
                <span class="likes-count">@post.Likes.Count</span>
            </div>
        </div>
    </div>
}

<script src="~/js/feed.js" />